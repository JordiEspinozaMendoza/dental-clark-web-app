{"ast":null,"code":"import _slicedToArray from\"C:/Users/dell/Documents/Proyects/Dental Clark/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import Loader from\"../../components/Loader\";import Message from\"../../components/Message\";import Paginate from\"../../components/Paginator\";import{Form,Button,Row,Col,Table}from\"react-bootstrap\";import{useDispatch,useSelector}from\"react-redux\";import{LinkContainer}from\"react-router-bootstrap\";import{getUserDetails,updateUserProfile}from\"../../actions/userActions\";import{getPatientDetails}from\"../../actions/patientActions\";import{USER_UPDATE_PROFILE_RESET}from\"../../constants/userConstants\";import{history as consultsHistory}from\"../../actions/consultActions\";import ModalPatient from\"../../components/Dashboard/components/patients/components/modalPatient\";// import { ModalConsult } from \"../../components/Dashboard/components/consults/components/modalConsult\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function ProfileScreen(_ref){var history=_ref.history;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),lgShow=_useState2[0],setLgShow=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),email=_useState4[0],setEmail=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),password=_useState6[0],setPassword=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),passwordConfirm=_useState8[0],setPasswordConfirm=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),name=_useState10[0],setName=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),message=_useState12[0],setMessage=_useState12[1];var dispatch=useDispatch();var userDetails=useSelector(function(state){return state.userDetails;});var error=userDetails.error,loading=userDetails.loading,user=userDetails.user;var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var userUpdateProfile=useSelector(function(state){return state.userUpdateProfile;});var success=userUpdateProfile.success;var _useState13=useState(1),_useState14=_slicedToArray(_useState13,2),pageToSearch=_useState14[0],setPageToSearch=_useState14[1];var consultHistory=useSelector(function(state){return state.consultHistory;});var loadingHistory=consultHistory.loading,errorHistory=consultHistory.error,myConsults=consultHistory.consults,pages=consultHistory.pages;var patientDetails=useSelector(function(state){return state.patientDetails;});var loadingPatientDetails=patientDetails.loading,errorPatientDetails=patientDetails.error,patient=patientDetails.patient;var patientDetailsHandler=function patientDetailsHandler(id){dispatch(getPatientDetails(id));};useEffect(function(){if(!userInfo){history.push(\"/login\");}else{if(!user||!user.name||success||userInfo._id!==user._id){dispatch({type:USER_UPDATE_PROFILE_RESET});dispatch(getUserDetails(userInfo._id));dispatch(consultsHistory(\"user\",userInfo._id,pageToSearch));}else{dispatch(consultsHistory(\"user\",user._id,pageToSearch));setName(user.name);setEmail(user.email);}}},[history,dispatch,userInfo,user,success]);useEffect(function(){dispatch(consultsHistory(\"user\",user._id,pageToSearch));},[pageToSearch,dispatch,lgShow]);var submitHandler=function submitHandler(e){e.preventDefault();if(password!=passwordConfirm)setMessage(\"Ambas contraseñas deben coincidir\");else{dispatch(updateUserProfile({id:user._id,name:name,email:email,password:password}));setMessage(\"\");}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Row,{className:\"p-5\",style:{minHeight:\"100vh\"},children:[/*#__PURE__*/_jsxs(Col,{md:3,className:\"float-left\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Mi perfil\"}),message&&/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:message}),error&&/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:error}),loading&&/*#__PURE__*/_jsx(Loader,{}),/*#__PURE__*/_jsxs(Form,{onSubmit:submitHandler,children:[/*#__PURE__*/_jsxs(Form.Group,{controlId:\"name\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Nombre\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Ingresa tu nombre\",value:name,onChange:function onChange(e){return setName(e.target.value);}})]}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"email\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Correo electronico\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"email\",placeholder:\"Ingresa tu correo\",value:email,onChange:function onChange(e){return setEmail(e.target.value);}})]}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"password\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Contrase\\xF1a\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"password\",placeholder:\"Ingresa tu contrase\\xF1a\",value:password,onChange:function onChange(e){return setPassword(e.target.value);}})]}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"passwordConfirm\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Confirmar contrase\\xF1a\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"password\",placeholder:\"Confirma tu contrase\\xF1a\",value:passwordConfirm,onChange:function onChange(e){return setPasswordConfirm(e.target.value);}})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",children:\"Actualizar perfil\"})]})]}),/*#__PURE__*/_jsxs(Col,{md:9,className:\"float-left\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Mis consultas\"}),loadingHistory?/*#__PURE__*/_jsx(Loader,{}):errorHistory?/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:errorHistory}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Table,{striped:true,bordered:true,hover:true,responsive:true,className:\"table-sm mt-3\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Paciente\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Fecha\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Detalles / tratamiento\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Precio total\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Saldo pendiente\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:myConsults&&!lgShow&&(myConsults===null||myConsults===void 0?void 0:myConsults.map(function(consult){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{onClick:function onClick(){setLgShow(true);patientDetailsHandler(consult.patient[\"_id\"]);},className:\"editPerson\",children:consult.patient[\"name\"]}),/*#__PURE__*/_jsx(\"td\",{children:consult.date.substring(0,10)}),/*#__PURE__*/_jsx(\"td\",{children:consult.details}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$ \",consult.price]}),consult.price-consult.payment>0?/*#__PURE__*/_jsxs(\"td\",{style:{color:\"red\"},children:[\"$\",consult.price-consult.payment]}):/*#__PURE__*/_jsx(\"td\",{style:{color:\"green\"},children:\"PAGO COMPLETO\"})]},consult._id);}))})]}),/*#__PURE__*/_jsx(Paginate,{pages:pages,changePage:function changePage(value){return setPageToSearch(value);},pageToSearch:pageToSearch})]})]}),/*#__PURE__*/_jsx(ModalPatient,{lgShow:lgShow,loadingPatientDetails:loadingPatientDetails,errorPatientDetails:errorPatientDetails,patient:patient,hide:function hide(){return setLgShow(false);}})]}),/*#__PURE__*/_jsx(\"div\",{class:\"clearfix\"})]});}","map":{"version":3,"sources":["C:/Users/dell/Documents/Proyects/Dental Clark/backend/frontend/src/views/ProfileScreen/index.js"],"names":["React","useState","useEffect","Loader","Message","Paginate","Form","Button","Row","Col","Table","useDispatch","useSelector","LinkContainer","getUserDetails","updateUserProfile","getPatientDetails","USER_UPDATE_PROFILE_RESET","history","consultsHistory","ModalPatient","ProfileScreen","lgShow","setLgShow","email","setEmail","password","setPassword","passwordConfirm","setPasswordConfirm","name","setName","message","setMessage","dispatch","userDetails","state","error","loading","user","userLogin","userInfo","userUpdateProfile","success","pageToSearch","setPageToSearch","consultHistory","loadingHistory","errorHistory","myConsults","consults","pages","patientDetails","loadingPatientDetails","errorPatientDetails","patient","patientDetailsHandler","id","push","_id","type","submitHandler","e","preventDefault","minHeight","target","value","map","consult","date","substring","details","price","payment","color"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\n\r\nimport Loader from \"../../components/Loader\";\r\nimport Message from \"../../components/Message\";\r\nimport Paginate from \"../../components/Paginator\";\r\nimport { Form, Button, Row, Col, Table } from \"react-bootstrap\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { LinkContainer } from \"react-router-bootstrap\";\r\n\r\nimport { getUserDetails, updateUserProfile } from \"../../actions/userActions\";\r\nimport { getPatientDetails } from \"../../actions/patientActions\";\r\nimport { USER_UPDATE_PROFILE_RESET } from \"../../constants/userConstants\";\r\n\r\nimport { history as consultsHistory } from \"../../actions/consultActions\";\r\nimport ModalPatient from \"../../components/Dashboard/components/patients/components/modalPatient\";\r\n// import { ModalConsult } from \"../../components/Dashboard/components/consults/components/modalConsult\";\r\n\r\nexport default function ProfileScreen({ history }) {\r\n  const [lgShow, setLgShow] = useState(false);\r\n\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [passwordConfirm, setPasswordConfirm] = useState(\"\");\r\n  const [name, setName] = useState(\"\");\r\n\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  const userDetails = useSelector((state) => state.userDetails);\r\n  const { error, loading, user } = userDetails;\r\n\r\n  const userLogin = useSelector((state) => state.userLogin);\r\n  const { userInfo } = userLogin;\r\n\r\n  const userUpdateProfile = useSelector((state) => state.userUpdateProfile);\r\n  const { success } = userUpdateProfile;\r\n\r\n  const [pageToSearch, setPageToSearch] = useState(1);\r\n  const consultHistory = useSelector((state) => state.consultHistory);\r\n\r\n  const {\r\n    loading: loadingHistory,\r\n    error: errorHistory,\r\n    consults: myConsults,\r\n    pages,\r\n  } = consultHistory;\r\n\r\n  const patientDetails = useSelector((state) => state.patientDetails);\r\n  const {\r\n    loading: loadingPatientDetails,\r\n    error: errorPatientDetails,\r\n    patient,\r\n  } = patientDetails;\r\n\r\n  const patientDetailsHandler = (id) => {\r\n    dispatch(getPatientDetails(id));\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!userInfo) {\r\n      history.push(\"/login\");\r\n    } else {\r\n      if (!user || !user.name || success || userInfo._id !== user._id) {\r\n        dispatch({ type: USER_UPDATE_PROFILE_RESET });\r\n        dispatch(getUserDetails(userInfo._id));\r\n        dispatch(consultsHistory(\"user\", userInfo._id, pageToSearch));\r\n      } else {\r\n        dispatch(consultsHistory(\"user\", user._id, pageToSearch));\r\n\r\n        setName(user.name);\r\n        setEmail(user.email);\r\n      }\r\n    }\r\n  }, [history, dispatch, userInfo, user, success]);\r\n  useEffect(() => {\r\n    dispatch(consultsHistory(\"user\", user._id, pageToSearch));\r\n  }, [pageToSearch, dispatch, lgShow]);\r\n  const submitHandler = (e) => {\r\n    e.preventDefault();\r\n    if (password != passwordConfirm)\r\n      setMessage(\"Ambas contraseñas deben coincidir\");\r\n    else {\r\n      dispatch(updateUserProfile({ id: user._id, name, email, password }));\r\n      setMessage(\"\");\r\n    }\r\n  };\r\n  return (\r\n    <>\r\n      <Row className=\"p-5\" style={{ minHeight: \"100vh\" }}>\r\n        <Col md={3} className=\"float-left\">\r\n          <h2>Mi perfil</h2>\r\n          {message && <Message variant=\"danger\">{message}</Message>}\r\n          {error && <Message variant=\"danger\">{error}</Message>}\r\n          {loading && <Loader />}\r\n\r\n          <Form onSubmit={submitHandler}>\r\n            <Form.Group controlId=\"name\">\r\n              <Form.Label>Nombre</Form.Label>\r\n              <Form.Control\r\n                type=\"text\"\r\n                placeholder=\"Ingresa tu nombre\"\r\n                value={name}\r\n                onChange={(e) => setName(e.target.value)}\r\n              ></Form.Control>\r\n            </Form.Group>\r\n\r\n            <Form.Group controlId=\"email\">\r\n              <Form.Label>Correo electronico</Form.Label>\r\n              <Form.Control\r\n                type=\"email\"\r\n                placeholder=\"Ingresa tu correo\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n              ></Form.Control>\r\n            </Form.Group>\r\n\r\n            <Form.Group controlId=\"password\">\r\n              <Form.Label>Contraseña</Form.Label>\r\n              <Form.Control\r\n                type=\"password\"\r\n                placeholder=\"Ingresa tu contraseña\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n              ></Form.Control>\r\n            </Form.Group>\r\n\r\n            <Form.Group controlId=\"passwordConfirm\">\r\n              <Form.Label>Confirmar contraseña</Form.Label>\r\n              <Form.Control\r\n                type=\"password\"\r\n                placeholder=\"Confirma tu contraseña\"\r\n                value={passwordConfirm}\r\n                onChange={(e) => setPasswordConfirm(e.target.value)}\r\n              ></Form.Control>\r\n            </Form.Group>\r\n            <Button type=\"submit\" variant=\"primary\">\r\n              Actualizar perfil\r\n            </Button>\r\n          </Form>\r\n        </Col>\r\n\r\n        <Col md={9} className=\"float-left\">\r\n          <h2>Mis consultas</h2>\r\n\r\n          {loadingHistory ? (\r\n            <Loader />\r\n          ) : errorHistory ? (\r\n            <Message variant=\"danger\">{errorHistory}</Message>\r\n          ) : (\r\n            <>\r\n              <Table\r\n                striped\r\n                bordered\r\n                hover\r\n                responsive\r\n                className=\"table-sm mt-3\"\r\n              >\r\n                <thead>\r\n                  <tr>\r\n                    <th>Paciente</th>\r\n                    <th>Fecha</th>\r\n                    <th>Detalles / tratamiento</th>\r\n                    <th>Precio total</th>\r\n                    <th>Saldo pendiente</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {myConsults &&\r\n                    !lgShow &&\r\n                    myConsults?.map((consult) => (\r\n                      <tr key={consult._id}>\r\n                        <td\r\n                          onClick={() => {\r\n                            setLgShow(true);\r\n                            patientDetailsHandler(consult.patient[\"_id\"]);\r\n                          }}\r\n                          className=\"editPerson\"\r\n                        >\r\n                          {consult.patient[\"name\"]}\r\n                        </td>\r\n\r\n                        <td>{consult.date.substring(0, 10)}</td>\r\n                        <td>{consult.details}</td>\r\n                        <td>$ {consult.price}</td>\r\n                        {consult.price - consult.payment > 0 ? (\r\n                          <td style={{ color: \"red\" }}>\r\n                            ${consult.price - consult.payment}\r\n                          </td>\r\n                        ) : (\r\n                          <td style={{ color: \"green\" }}>PAGO COMPLETO</td>\r\n                        )}\r\n                      </tr>\r\n                    ))}\r\n                </tbody>\r\n              </Table>\r\n              <Paginate\r\n                pages={pages}\r\n                changePage={(value) => setPageToSearch(value)}\r\n                pageToSearch={pageToSearch}\r\n              ></Paginate>\r\n            </>\r\n          )}\r\n        </Col>\r\n        <ModalPatient\r\n          lgShow={lgShow}\r\n          loadingPatientDetails={loadingPatientDetails}\r\n          errorPatientDetails={errorPatientDetails}\r\n          patient={patient}\r\n          hide={() => setLgShow(false)}\r\n        ></ModalPatient>\r\n      </Row>\r\n      <div class=\"clearfix\"></div>\r\n    </>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}